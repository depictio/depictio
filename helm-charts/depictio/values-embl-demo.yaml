# EMBL Stable Demo Environment - demo.depictio.embl.org
# Only stable tags (without -b* suffix) deploy to this environment
#
# Layered on top of:
#   - values.yaml (base configuration)
#   - values-embl-demo-base.yaml (EMBL infrastructure + demo mode)
#   - values-embl-secrets.yaml (S3 credentials)

# Demo environment configuration - auto-wipe on upgrades
demo:
  autoWipeOnUpgrade: true  # Delete PVCs before each upgrade for fresh demo state

# Celery worker (enabled for background tasks)
celery:
  enabled: true
  replicas: 1
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "1"

# Google Analytics - Production Tracking ID
backend:
  env:
    # Demo mode with guided tour tooltips
    DEPICTIO_AUTH_DEMO_MODE: "true"
    DEPICTIO_AUTH_PUBLIC_MODE: "true"
    # Anonymous user configuration
    DEPICTIO_AUTH_ANONYMOUS_USER_EMAIL: "anonymous@depict.io"
    DEPICTIO_AUTH_TEMPORARY_USER_EXPIRY_HOURS: "1"
    # Configuration
    DEPICTIO_DEV_MODE: "false"
    DEPICTIO_MONGODB_WIPE: "true"
    DEPICTIO_GOOGLE_ANALYTICS_ENABLED: "true"
    DEPICTIO_GOOGLE_ANALYTICS_TRACKING_ID: "G-GM8MYRJDHL"
    # Explicit API URL to match ingress host (overrides computed URL)
    DEPICTIO_FASTAPI_PUBLIC_URL: "https://api.demo.depictio.embl.org"

frontend:
  env:
    # Demo mode with guided tour tooltips
    DEPICTIO_AUTH_DEMO_MODE: "true"
    DEPICTIO_AUTH_PUBLIC_MODE: "true"
    # Anonymous user configuration
    DEPICTIO_AUTH_ANONYMOUS_USER_EMAIL: "anonymous@depict.io"
    DEPICTIO_AUTH_TEMPORARY_USER_EXPIRY_HOURS: "1"
    # Configuration
    DEPICTIO_DEV_MODE: "false"
    DEPICTIO_GOOGLE_ANALYTICS_ENABLED: "true"
    DEPICTIO_GOOGLE_ANALYTICS_TRACKING_ID: "G-GM8MYRJDHL"

# Ingress - Stable Demo Environment
ingress:
  enabled: true
  ingressClassName: "external-users"

  annotations:
    cert-manager.io/cluster-issuer: harica-issuer
    # WebSocket support for Dash real-time updates over HTTPS
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    nginx.ingress.kubernetes.io/websocket-services: "demo-depictio-frontend"
    nginx.ingress.kubernetes.io/configuration-snippet: |
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";

  hosts:
    - host: "demo.depictio.embl.org"
      paths:
        - path: /
          pathType: Prefix
          service:
            name: depictio-frontend
            portName: http
    - host: "api.demo.depictio.embl.org"
      paths:
        - path: /
          pathType: Prefix
          service:
            name: depictio-backend
            portName: http

  tls:
    - hosts:
        - "demo.depictio.embl.org"
        - "api.demo.depictio.embl.org"
      secretName: demo-depictio-tls

# Global domain settings
global:
  domain: "depictio.embl.org"
  urlPattern:
    type: "prefix"
    subdomain: ""
