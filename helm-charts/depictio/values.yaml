# =====================================================
# Depictio Helm Chart Configuration
# =====================================================
# This file contains the default configuration values for Depictio deployment.
# Override these values in environment-specific values files.

# Global values
nameOverride: ""
fullnameOverride: ""

# Application configuration
appname: "depictio"

# Project configuration (required for Kubernetes labels and selectors)
project:
  slug: "depictio"  # Used in matchLabels - change for different project instances

# Storage settings
storageClass: "standard"
persistence:
  mongo:
    size: 1Gi
    accessMode: ReadWriteMany
  minio:
    size: 1Gi
    accessMode: ReadWriteMany
  screenshots:
    size: 100Mi
    accessMode: ReadWriteMany
  keys:
    size: 1Mi
    accessMode: ReadWriteMany
  config:
    size: 10Mi
    accessMode: ReadWriteMany
  uploads:
    size: 5Gi
    accessMode: ReadWriteMany

# Secrets
secrets:
  # Optionally override the generated MinIO access key
  minioRootUser: ""
  # Optionally override the generated MinIO secret key
  minioRootPassword: ""

local_development: false # Set to true for local development

# MongoDB settings
mongo:
  image:
    repository: mongo # Added repository for MongoDB
    tag: latest
    pullPolicy: IfNotPresent
  replicas: 1 # Set to 3 for high availability replica set
  resources:
    requests:
      memory: "1Gi"
      cpu: "0.5"
    limits:
      memory: "1Gi"
      cpu: "1"
  service:
    type: ClusterIP
    port: 27018
  securityContext:
    runAsNonRoot: false # Default allows root for compatibility
    allowPrivilegeEscalation: true
    capabilities: {}
    seccompProfile:
      type: RuntimeDefault

# Redis settings
redis:
  enabled: true
  image:
    repository: redis
    tag: "8.2.1"
    pullPolicy: IfNotPresent
  replicas: 1
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  service:
    type: ClusterIP
    port: 6379
  persistence:
    size: 1Gi
    accessMode: ReadWriteOnce
  securityContext:
    runAsNonRoot: true
    runAsUser: 999  # Redis default user
    runAsGroup: 999
    allowPrivilegeEscalation: false
    capabilities:
      drop:
      - ALL
    seccompProfile:
      type: RuntimeDefault

# MinIO settings
minio:
  enabled: true
  image:
    repository: minio/minio
    tag: latest
    pullPolicy: IfNotPresent
  resources:
    requests:
      memory: "1Gi"
      cpu: "0.5"
    limits:
      memory: "1Gi"
      cpu: "1"
  service:
    type: ClusterIP
    httpPort: 9000
    consolePort: 9001
  securityContext:
    runAsNonRoot: false # Default allows root for compatibility
    allowPrivilegeEscalation: true
    capabilities: {}
    seccompProfile:
      type: RuntimeDefault
  env:
    # Default MinIO credentials - these will be overridden by values-embl-secrets.yaml
    DEPICTIO_MINIO_ROOT_USER: "minio"
    DEPICTIO_MINIO_ROOT_PASSWORD: "minio123"
    DEPICTIO_MINIO_BUCKET: "depictio-bucket"
    DEPICTIO_MINIO_SERVICE_PORT: "9000"

# Backend settings
backend:
  image:
    repository: ghcr.io/depictio/depictio # Corrected repository path with .io
    tag: "0.6.0-b1"
    pullPolicy: Always
  replicas: 1 # Balanced for stability and performance
  resources:
    requests:
      memory: "1Gi"
      cpu: "0.5"
    limits:
      memory: "4Gi"
      cpu: "2"
  service:
    type: ClusterIP
    httpPort: 80
    httpsPort: 443
    targetPort: 8058
  env:
    DEPICTIO_CONTEXT: "server"
    DEV_MODE: "false"
    DEPICTIO_LOGGING_VERBOSITY_LEVEL: "INFO"
    DEPICTIO_FASTAPI_SERVICE_PORT: "80"
    DEPICTIO_DASH_SERVICE_PORT: "80"
    DEPICTIO_MONGODB_WIPE: "false" # Set to true for development to wipe MongoDB on startup
    DEPICTIO_MONGODB_SERVICE_PORT: "27018"
    # DEPICTIO_MINIO_SERVICE_PORT: "9000"
    # DEPICTIO_DASH_SERVICE_NAME: "depictio-frontend"
    # DEPICTIO_FASTAPI_PUBLIC_URL: "https://{{ .Release.Name }}-api.{{ .Values.global.domain }}"
    # DEPICTIO_MINIO_PUBLIC_URL: "https://{{ .Release.Name }}-minio.{{ .Values.global.domain }}"
    # Performance - Reduced workers for better stability with multiple replicas
    DEPICTIO_FASTAPI_WORKERS: "4"

    # Redis Cache Configuration
    DEPICTIO_CACHE_REDIS_HOST: "redis"
    DEPICTIO_CACHE_REDIS_PORT: "6379"
    DEPICTIO_CACHE_REDIS_DB: "0"
    DEPICTIO_CACHE_ENABLE_REDIS_CACHE: "true"

    # Celery Configuration (uses Redis as broker)
    DEPICTIO_CELERY_BROKER_HOST: "redis"
    DEPICTIO_CELERY_BROKER_PORT: "6379"
    DEPICTIO_CELERY_BROKER_DB: "1"
    DEPICTIO_CELERY_RESULT_BACKEND_HOST: "redis"
    DEPICTIO_CELERY_RESULT_BACKEND_PORT: "6379"
    DEPICTIO_CELERY_RESULT_BACKEND_DB: "2"

    # Enable unauthenticated mode (allows anonymous access)
    DEPICTIO_AUTH_UNAUTHENTICATED_MODE: "false"

    # Anonymous user configuration
    DEPICTIO_AUTH_ANONYMOUS_USER_EMAIL: "anonymous@depict.io"
    DEPICTIO_AUTH_TEMPORARY_USER_EXPIRY_HOURS: "24"

    # Analytics configuration
    DEPICTIO_ANALYTICS_ENABLED: "false"
    DEPICTIO_ANALYTICS_SESSION_TIMEOUT_MINUTES: "30"
    DEPICTIO_ANALYTICS_CLEANUP_DAYS: "90"
    DEPICTIO_ANALYTICS_TRACK_ANONYMOUS_USERS: "true"
    DEPICTIO_ANALYTICS_CLEANUP_ENABLED: "true"

    # Google Analytics configuration (GA4)
    # Enable to track page views, user interactions, and engagement metrics
    # Get your tracking ID from Google Analytics dashboard (Property → Data Streams)
    DEPICTIO_GOOGLE_ANALYTICS_ENABLED: "false"
    DEPICTIO_GOOGLE_ANALYTICS_TRACKING_ID: "G-XXXXXXXXXX"

  podSecurityContext:
    runAsUser: 1000
    runAsGroup: 2000
    fsGroup: 2000
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 2000
    allowPrivilegeEscalation: false
    capabilities:
      drop:
      - ALL
    seccompProfile:
      type: RuntimeDefault

# Frontend settings
frontend:
  image:
    repository: ghcr.io/depictio/depictio # Corrected repository path with .io
    tag: "0.6.0-b1"
    pullPolicy: Always
  replicas: 1 # Balanced for stability and performance
  resources:
    requests:
      memory: "1Gi"
      cpu: "0.5"
    limits:
      memory: "4Gi"
      cpu: "2"
  service:
    type: ClusterIP
    httpPort: 80
    httpsPort: 443
    targetPort: 5080
  env:
    DEPICTIO_CONTEXT: "server"
    DEV_MODE: "false"
    DEPICTIO_FASTAPI_SERVICE_PORT: "80"
    DEPICTIO_MONGODB_SERVICE_PORT: "27018"
    DEPICTIO_DASH_SERVICE_PORT: "5080"
    # DEPICTIO_MINIO_SERVICE_PORT: "9000"
    # DEPICTIO_FASTAPI_PUBLIC_URL: "https://{{ .Release.Name }}-api.{{ .Values.global.domain }}"
    # DEPICTIO_MINIO_PUBLIC_URL: "https://{{ .Release.Name }}-minio.{{ .Values.global.domain }}"

    # Performance - Reduced workers for better stability with multiple replicas
    DEPICTIO_DASH_WORKERS: "4"

    # Redis Cache Configuration
    DEPICTIO_CACHE_REDIS_HOST: "redis"
    DEPICTIO_CACHE_REDIS_PORT: "6379"
    DEPICTIO_CACHE_REDIS_DB: "0"
    DEPICTIO_CACHE_ENABLE_REDIS_CACHE: "true"

    # Celery Configuration (uses Redis as broker)
    DEPICTIO_CELERY_BROKER_HOST: "redis"
    DEPICTIO_CELERY_BROKER_PORT: "6379"
    DEPICTIO_CELERY_BROKER_DB: "1"
    DEPICTIO_CELERY_RESULT_BACKEND_HOST: "redis"
    DEPICTIO_CELERY_RESULT_BACKEND_PORT: "6379"
    DEPICTIO_CELERY_RESULT_BACKEND_DB: "2"

    # Analytics configuration
    DEPICTIO_ANALYTICS_ENABLED: "false"

    # Google Analytics configuration (GA4)
    # Enable to track page views, user interactions, and engagement metrics
    # Get your tracking ID from Google Analytics dashboard (Property → Data Streams)
    DEPICTIO_GOOGLE_ANALYTICS_ENABLED: "false"
    # DEPICTIO_GOOGLE_ANALYTICS_TRACKING_ID: "G-XXXXXXXXXX"

  podSecurityContext:
    runAsUser: 1000
    runAsGroup: 2000
    fsGroup: 2000
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 2000
    allowPrivilegeEscalation: false
    capabilities:
      drop:
      - ALL
    seccompProfile:
      type: RuntimeDefault

# Generic base ingress values
ingress:
  enabled: true
  ingressClassName: "nginx" # Default ingress class

  # You can leave hosts empty here since environment-specific values will override
  hosts: []

  # Default empty annotations and labels
  annotations: {}
  labels: {}

  # Empty TLS configuration by default
  tls: []

# Init container resource configuration
initContainerResources:
  requests:
    memory: "64Mi"
    cpu: "50m"
  limits:
    memory: "128Mi"
    cpu: "100m"

global:
  domain: "example.com" # Default domain, can be overridden in environment-specific values

  # URL pattern configuration
  # Controls how service URLs are constructed for ingress and public access
  urlPattern:
    # Pattern type: "prefix" | "subdomain" | "custom"
    # - "prefix" (default): {release}-{service}.{domain}
    #     Example: demo-api.example.com
    # - "subdomain": {subdomain}{service}.{release}.{domain}
    #     Example: dev.api.demo.example.com
    # - "custom": Use custom template strings defined below
    type: "prefix"

    # Optional subdomain prefix (used with "subdomain" pattern type)
    # Examples: "dev", "staging", "prod"
    # Will automatically add trailing dot if not present
    subdomain: ""

    # Custom URL templates (used when type is "custom")
    # Available template variables: .Release.Name, .Values.global.domain, .Values.global.urlPattern.subdomain
    # These are Go templates evaluated at deployment time
    templates:
      # API service URL pattern
      # Default: "{{ .Release.Name }}-api.{{ .Values.global.domain }}"
      api: ""
      # Frontend service URL pattern
      # Default: "{{ .Release.Name }}.{{ .Values.global.domain }}"
      frontend: ""
      # MinIO service URL pattern
      # Default: "{{ .Release.Name }}-minio.{{ .Values.global.domain }}"
      minio: ""
