#!/usr/bin/env bash
# File generated by pre-commit: https://pre-commit.com
# ID: 138fd403232d2ddd5efb44317e38bf03
# Modified to auto-detect virtualenv location

# start templated
ARGS=(hook-impl --config=.pre-commit-config.yaml --hook-type=pre-commit)
# end templated

HERE="$(cd "$(dirname "$0")" && pwd)"
ARGS+=(--hook-dir "$HERE" -- "$@")

# Try to find pre-commit in multiple locations
REPO_ROOT="$(cd "$HERE/../.." && pwd)"

# 1. Try local venv in project (depictio-venv-dash-v3 or similar)
for venv_dir in "$REPO_ROOT"/depictio-venv-*; do
    if [ -x "$venv_dir/bin/python" ]; then
        INSTALL_PYTHON="$venv_dir/bin/python"
        break
    fi
done

# 2. Try uv tools location (devcontainer)
if [ -z "$INSTALL_PYTHON" ] && [ -x "/home/vscode/.local/share/uv/tools/pre-commit/bin/python" ]; then
    INSTALL_PYTHON="/home/vscode/.local/share/uv/tools/pre-commit/bin/python"
fi

# 3. Try .venv in project root (fresh uv install)
if [ -z "$INSTALL_PYTHON" ] && [ -x "$REPO_ROOT/.venv/bin/python" ]; then
    INSTALL_PYTHON="$REPO_ROOT/.venv/bin/python"
fi

# Execute pre-commit
if [ -n "$INSTALL_PYTHON" ] && [ -x "$INSTALL_PYTHON" ]; then
    exec "$INSTALL_PYTHON" -mpre_commit "${ARGS[@]}"
elif command -v pre-commit > /dev/null; then
    exec pre-commit "${ARGS[@]}"
else
    echo "\`pre-commit\` not found.  Did you forget to activate your virtualenv?" 1>&2
    echo 'Searched locations:' 1>&2
    echo "  - $REPO_ROOT/depictio-venv-*" 1>&2
    echo "  - /home/vscode/.local/share/uv/tools/pre-commit" 1>&2
    echo "  - $REPO_ROOT/.venv" 1>&2
    exit 1
fi
