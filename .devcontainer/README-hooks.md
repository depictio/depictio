# Git Hooks Setup - Environment-Agnostic Pre-commit

## Problem

The default pre-commit hook generated by `pre-commit install` hardcodes the Python path, causing failures when:
- Committing from VSCode Git UI on Mac (looks for `/home/vscode/.local/share/uv/tools/pre-commit/bin/python`)
- Switching between Mac, devcontainer, or fresh uv installations

## Solution

This repository uses an **environment-agnostic pre-commit hook** that auto-detects Python in multiple locations:

1. **Local venv**: `depictio-venv-*` (Mac/Linux development)
2. **Devcontainer**: `/home/vscode/.local/share/uv/tools/pre-commit/bin/python`
3. **Fresh uv install**: `.venv/bin/python` (project root)
4. **System fallback**: System-wide `pre-commit` command

## How It Works

### Tracked Files

```
.devcontainer/
├── hooks/
│   └── pre-commit              # Environment-agnostic hook template (tracked in git)
├── scripts/
│   └── setup-pre-commit.sh     # Standalone setup script (tracked in git)
└── post_create_setup.sh        # Devcontainer setup (auto-applies hook)
```

### Automatic Setup (Devcontainer)

When devcontainer starts, `post_create_setup.sh` automatically:
1. Runs `pre-commit install` (generates default hook)
2. Copies `.devcontainer/hooks/pre-commit` to `.git/hooks/pre-commit`
3. Makes it executable

### Manual Setup (Mac/Linux)

Run the standalone script:

```bash
bash .devcontainer/scripts/setup-pre-commit.sh
```

Or manually:

```bash
pre-commit install
cp .devcontainer/hooks/pre-commit .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

## Benefits

✅ **Tracked in git**: The improved hook is version-controlled
✅ **Auto-applies in devcontainer**: No manual intervention needed
✅ **Easy local setup**: One command for Mac/Linux users
✅ **Works everywhere**: Mac, Linux, devcontainer, fresh uv installs
✅ **VSCode Git UI compatible**: Commits work from VSCode Source Control panel

## Verification

Test that commits work:

```bash
# Terminal
git commit -m "test"

# VSCode Git UI
# Click the commit button in Source Control panel
```

Both should trigger pre-commit hooks successfully!

## Why Not Track .git/hooks Directly?

The `.git/` directory is **never tracked by git** - it's git's internal directory structure. That's why we:
1. Store the hook template in `.devcontainer/hooks/` (tracked)
2. Copy it to `.git/hooks/` during setup (not tracked)

This is the standard approach used by all git hook management systems (pre-commit, husky, etc.).
