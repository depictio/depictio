services:
  app:
    build:
      context: .
      dockerfile: .devcontainer/Dockerfile
    init: true
    volumes:
      - .:/workspace:cached
      - /var/run/docker.sock:/var/run/docker.sock
      # Gemini and Qwen: direct bind mounts (working)
      - ~/.gemini:/home/vscode/.gemini
      - ~/.qwen:/home/vscode/.qwen
      # Claude Code: Docker volume (Mac/Linux credential incompatibility)
      - claude-code-config:/home/vscode/.claude
    command: sleep infinity
    user: vscode
    depends_on:
      mongo:
        condition: service_started
      redis:
        condition: service_healthy
      minio:
        condition: service_started
      depictio-backend:
        condition: service_started
      depictio-frontend:
        condition: service_started
    environment:
      - DEPICTIO_CONTEXT=server
      - DEPICTIO_MONGODB_SERVICE_NAME=mongo
      - DEPICTIO_MONGODB_PORT=27018
      - DEPICTIO_MINIO_ROOT_USER=minio
      - DEPICTIO_MINIO_ROOT_PASSWORD=minio123
      - DEPICTIO_MINIO_ENDPOINT_URL=http://minio:9000
      - CLAUDE_CONFIG_DIR=/home/vscode/.claude

volumes:
  claude-code-config:
