version: '3.8'

services:
  mongo:
    # image: mongo:latest
    image: mongodb/mongodb-community-server:latest
    command: --dbpath /data/depictioDB --port 27018
    ports:
      - "27018:27018"
    volumes:
      - /Users/tweber/Gits/depictio/depictioDB:/data/depictioDB

  redis:
    image: redis:latest
    command: redis-server
    ports:
      - "6379:6379"

  redis-cli-monitor:
    image: redis:latest
    command: redis-cli -h redis monitor
    depends_on:
      - redis


  minio:
    image: minio/minio:latest
    volumes:
      - ./minio_data:/data
    environment:
      MINIO_ROOT_USER: minio
      MINIO_ROOT_PASSWORD: minio123
      MINIO_ACCESS_KEY: minio
      MINIO_SECRET_KEY: minio123
    command: server /data --console-address :9001
    ports:
      - "9000:9000"
      - "9001:9001"




  jbrowse2:
    image: jbrowse2:latest
    build:
      dockerfile: docker-images/Dockerfile_jbrowse.dev.plugin.dockerfile
    ports: 
      - "3000:3000"
      - "9010:9010"
    volumes:
      - "/Users/tweber/Gits/jbrowse-watcher-plugin:/usr/src/plugin"
      # - "/Users/tweber/Gits/jbrowse2_config/jbrowse2_bak:/usr/src/plugin"




# Uncomment and configure the below services as per your application requirement

  depictio_frontend:
    # build:
    #   context: .
    #   dockerfile: docker-images/Dockerfile_depictio.dockerfile
    image: depictio_container
    ports:
      - "5080:5080" # Assuming frontend runs on 5080. Adjust if needed.
    volumes:
      - ./depictio:/app/depictio # Mount the local depictio directory
      # - /Users/tweber/Gits/depictio/CLI_client:/app/CLI_client
      - /Users:/Users # TMP - Mount the local Users directory
    command: ["python", "depictio/dash/app.py"]
    depends_on:
      - mongo
      - redis
      - minio
      - depictio_backend


  depictio_backend:
    # build:
    #   context: .
    #   dockerfile: docker-images/Dockerfile_depictio.dockerfile
    image: depictio_container
    ports:
      - "8058:8058"
    volumes:
      - ./depictio:/app/depictio
      # - /Users/tweber/Gits/depictio/CLI_client:/app/CLI_client
      - /Users:/Users # TMP - Mount the local Users directory 
    command: ["python", "depictio/api/run.py"]
    depends_on:
      - mongo
      - redis
      - minio



  # openldap:
  #   image: osixia/openldap:1.5.0
  #   environment:
  #     LDAP_ORGANISATION: "Depictio"
  #     LDAP_DOMAIN: "depictio.local"
  #     LDAP_ADMIN_PASSWORD: "admin"
  #   ports:
  #     - "389:389"
  #     - "636:636"
  #   volumes:
  #     - ./ldap_db:/var/lib/ldap
  #     - ./ldap_config:/etc/ldap/slapd.d

  # phpldapadmin:
  #   image: osixia/phpldapadmin:latest
  #   environment:
  #     PHPLDAPADMIN_LDAP_HOSTS: openldap
  #   ports:
  #     - "6443:443"
  #   depends_on:
  #     - openldap

  # keycloak:
  #   image: quay.io/keycloak/keycloak:22.0.5
  #   command: start-dev
  #   environment:
  #     KEYCLOAK_USER: user
  #     KEYCLOAK_PASSWORD: test
  #     KEYCLOAK_ADMIN: admin
  #     KEYCLOAK_ADMIN_PASSWORD: admin
  #   ports:
  #     - "8080:8080"
  #   depends_on:
  #     - openldap