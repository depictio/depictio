# Pixi configuration for depictio
# This allows running the project without Docker using pixi (https://pixi.sh)
# Install pixi: curl -fsSL https://pixi.sh/install.sh | bash
# Then run: pixi install

[project]
name = "depictio"
version = "0.6.0-b2"
description = "Depictio - Dashboard generation from workflows outputs"
authors = ["Thomas Weber <thomas.weber@embl.de>"]
channels = ["conda-forge"]
platforms = ["linux-64", "osx-arm64", "osx-64"]

[tasks]
# Development tasks
install-browsers = "playwright install chromium"
api = { cmd = "python depictio/api/run.py", depends-on = ["install-browsers"] }
dash = "python depictio/dash/flask_dispatcher.py"
celery = "celery -A depictio.api.celery_app worker --loglevel=info"

# Testing tasks
test = "pytest depictio/tests/ -xvs"
test-fast = "pytest depictio/tests/ -x --ignore=depictio/tests/e2e-tests"

# Code quality tasks
lint = "ruff check depictio/"
format = "ruff format depictio/"
typecheck = "ty check depictio/"
pre-commit = "pre-commit run --all-files"

[dependencies]
# Python version constraint
python = ">=3.11,<3.13"

# System dependencies for playwright/headless browser
# These are the minimal system deps needed for playwright on Linux
xvfb-run = { version = "*", platforms = ["linux-64"] }

[pypi-dependencies]
# All Python dependencies are managed via pypi for simplicity
# This references the pyproject.toml which contains the full dependency list
depictio = { path = ".", editable = true }

[feature.dev.dependencies]
# Development tools that benefit from conda (faster installation)
pre-commit = "*"

[feature.dev.pypi-dependencies]
# Development Python packages
ruff = ">=0.12.1"
ty = ">=0.0.1-alpha.12"
pytest = ">=8.4.1"
pytest-asyncio = ">=1.0.0"
pytest-xdist = ">=3.7.0"
pytest-cov = "*"
mongomock = ">=4.3.0"
mongomock-motor = ">=0.0.36"
bump2version = "*"
testcontainers = { version = "*", extras = ["minio"] }

[environments]
# Default environment with all features
default = { features = ["dev"], solve-group = "default" }

# Production-like environment (minimal)
prod = { features = [], solve-group = "prod" }

[activation]
scripts = ["scripts/setup_env.sh"]

[system-requirements]
# Linux system requirements for playwright browsers
linux = "4.4"
